---
title: "Anne Frank Netzwerk"
author: "Julia Gehringer, Sandra Belschner, Kai Roos, Theresa Stumpf, Luisa Scheurer, Celine Bischoff"
date: "2 3 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r Pakete installieren}
library(igraph) #Um die Netzwerke darzustellen
library(igraphdata) #Um Daten auslesen zu können
library(knitr) 
library(rmarkdown) 
library(graphlayouts)
library(dplyr)
```


```{r Hochladen der Edge- und Nodelist aus dem Github Verzeichnis}

#Daten aus der Edgelist laden
edges <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/edgelist.csv", header=T, as.is=T)

#Daten aus der Nodelist laden
nodes <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/nodelist.csv", header=T, as.is=T)

#Matrix erstellen aus Fusion der Edge- und Nodelist
edgematrix <-as.matrix(edges)
af <- graph_from_data_frame(d=edgematrix, vertices=nodes, directed=FALSE)
af

```

```{r Edge- und Node Atribute anzeigen}
#Kann durch {r results='hide'} ausgeblendet werden

list.vertex.attributes(af)
list.edge.attributes(af)
af

```

```{r Plot des Gesamtnetzwerks erstellen}

# Anzeige der möglichen Attribute in igraph
?igraph.plotting

# Veränderung der Füllfarbe des Vertex
V(af)$color <- "darkred"

# blendet den Rahmen um den Vertex aus.
V(af)$frame.color <- "NA" 

# Veränderung des Labels
#V(af)$label <- V(af)$name
      
# Zuweisungen für das Two-Mode Netzwerk
V(af)[V(af)$type == 1]$shape <- "circle"
V(af)[V(af)$type == 2]$shape <- "square"

plot (af, 
     edge.curved=curve_multiple(af),
     edge.curved=.15,
     layout=layout_with_kk,
     main="Gesamtnetzwerk Anne Frank",)
```

```{r Gesamtnetzwerk mit lediglich einer Edge zwischen den Nodes}

# Anzeige der möglichen Attribute in igraph
?igraph.plotting

af_time <- delete.edges(af,  E(af)[which_multiple(af, eids = E(af))]) #lässt nur eine Verbindung pro Knoten anzeigen

plot(af_time)

# Veränderung der Füllfarbe des Vertex
V(af_time)$color <- "darkred"

# blendet den Rahmen um den Vertex aus.
V(af_time)$frame.color <- "NA" 

# Veränderung des Labels
#V(af_time)$label <- V(af_time)$name
      
# Zuweisungen für das Two-Mode Netzwerk
V(af_time)[V(af_time)$type == 1]$shape <- "circle"
V(af_time)[V(af_time)$type == 2]$shape <- "square"

plot (af_time, 
     layout=layout_with_kk,
     main="Gesamtnetzwerk Anne Frank  \n (eine Edge zwischen den Nodes)")

```




```{r Gesamtnetzwerk entzerrt, fig.height=9, fig.width=9}

# Veränderung des Labels
V(af_time)$label <- V(af_time)$name
      
# Zuweisungen für das Two-Mode Netzwerk
V(af_time)[V(af_time)$type == 1]$shape <- "circle"
V(af_time)[V(af_time)$type == 2]$shape <- "square"

plot( 
  af_time,
  asp = 0,
  #Gibt an, in welchem Seitenverhältnis das Netzwerk geplottet werden soll
  rescale = TRUE,
  #Gibt an ob der Plot neu skaliert werden soll
  layout = layout_with_kk,
  #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
  #edge.curved=curve_multiple(af_time),
  edge.curved = .15,
  #Gibt die Krümmung der Kanten an
  vertex.size = 3.5,
  #Gibt die Knotengröße an
  vertex.color = "darkred",
  #Gibt die Knotenfarbe an
  vertex.frame.color = NA,
  #Gibt die Rahmenfarbe an
  main = "Gesamtnetzwerk Anne Frank",
  #Gibt die Überschrift an
  vertex.label.dist = 0.6,
  #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
  edge.lty = 1, #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket, 4=Punktstrich
  vertex.label.family = "Helvetica",
  #Gibt die Schriftart an
  vertex.label.color = "black",
  #Gibt die Schriftfarbe an
  vertex.label.font = 1,
  #Gibt die Schriftgröße an
  vertex.label.degree = pi/2,
  #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
  edge.color = gray(0.6, alpha=0.9) #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
)


```
```{r fig.height=9, fig.width=9, Degree-King Anne Frank}

# Wir wollen den Knoten mit dem höchsten Degree-Wert (Anne) hervorheben.

# Einfache Berechnung des Degree als Gesamtwert
degree_af <- degree(af_time)
degree_af

# Welcher Knoten hat den höchsten Degree-Wert?

which.max(degree_af)


#Die Zahlen unter den Personen stehen für die Anzahl der Kanten des jeweiligen Knoten

# Dauerhafte Markierung des Knoten 18 (in diesem Fall wir die Rahmenfarbe rot gesetzt)
V(af_time)[V(af_time)$name == "Anne Frank"]$frame.color <- "darkred"

# Zuweisungen für das Two-Mode Netzwerk
V(af_time)[V(af_time)$type == 1]$shape <- "circle"
V(af_time)[V(af_time)$type == 2]$shape <- "square"

plot ( af_time,
       
     layout=layout_with_kk,
     vertex.size=degree_af/15+2,
     vertex.label=NA,
     vertex.color="grey75",
     edge.color="grey80",
     main = "Degree-King Anne Frank",
     sub = "höchster degree-Wert in rot umrandet",
    asp = 0,
    #Gibt an, in welchem Seitenverhältnis das Netzwerk geplottet werden soll
    rescale = TRUE,
    #Gibt an ob der Plot neu skaliert werden soll
    layout = layout_with_kk,
    #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
    #edge.curved=curve_multiple(af_time),
    edge.curved = .15,
    #Gibt die Krümmung der Kanten an
    edge.arrow.size = .3,
    #Gibt die Pfeilgröße der Kanten an
    vertex.size = 3.5,
    #Gibt die Knotengröße an
    vertex.color = "darkred",
    #Gibt die Knotenfarbe an
    vertex.label.dist = 0.6,
    #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
    edge.lty = 1, #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket, 4=Punktstrich
    vertex.label.family = "Helvetica",
    #Gibt die Schriftart an
    vertex.label.color = "black",
    #Gibt die Schriftfarbe an
    vertex.label.font = 1,
    #Gibt die Schriftgröße an
    vertex.label.degree = pi/2,
    #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
    edge.color = gray(0.6, alpha=0.9) #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
)

```


```{r fig.height=9, fig.width=16, Egonetzwerk Anne Frank}

# Uns interessiert das Ego-Netzwerk vom Indegree-King (Anne)

#Zeigt die Beziehungen ersten Grades an 

# ego_size() zeigt uns den Wert mit den höchsten Verbindungen (degrees)
V(af_time)$egos <- ego_size(af_time)
vertex.attributes(af_time)$egos
which.max(vertex.attributes(af_time)$egos)

# erzeugt ein Egonetzwerk
ego_g <- make_ego_graph(af_time, order = 1, nodes = V(af_time)$name == "Anne Frank", mode ="all")
ego_net <- ego_g[[1]]

#Zuweisungen für das Two-Mode Netzwerk
V(ego_net)[V(ego_net)$type == 1]$shape <- "circle"
V(ego_net)[V(ego_net)$type == 2]$shape <- "square"

size <- E(ego_net)$width <- E(ego_net)$weight
E(ego_net)[E(ego_net)$weight == 1]$weight <- "0.5"
E(ego_net)[E(ego_net)$weight == 2]$weight <- "1"
E(ego_net)[E(ego_net)$weight == 3]$weight <- "1.5"
E(ego_net)[E(ego_net)$weight == 4]$weight <- "2"
E(ego_net)[E(ego_net)$weight == 5]$weight <- "2.5"

plot(ego_net,
     
     edge.width=E(ego_net)$weight,
     main="Ego-Netzwerk von Anne Frank",
     rescale = TRUE,
     asp = 0,
     layout = layout_nicely,
     #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
     edge.curved = .10,
     vertex.size = 5,
     vertex.color = "darkred",
     vertex.frame.color = NA,
     #Gibt die Rahmenfarbe an
     vertex.label.dist = 1.3,
     #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
     vertex.label.family = "Helvetica",
     #Gibt die Schriftart an
     vertex.label.color = "black",
     #Gibt die Schriftfarbe an
     vertex.label.font = 1,
     #Gibt die Schriftgröße an
     vertex.label.degree = pi/2,
     #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
     edge.size = size,
     #edge.lty = 1 #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket,       4=Punktstrich
     edge.color = gray(0.6, alpha=0.9)
     #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
    
     ) 
      

```



```{r fig.height=9, fig.width=16}
# Uns interessiert das Ego-Netzwerk vom Indegree-King (Anne)

#Zeigt die Beziehungen ersten Grades an 

# ego_size() zeigt uns den Wert mit den höchsten Verbindungen (degrees)
V(af_time)$egos <- ego_size(af_time)
vertex.attributes(af_time)$egos
which.max(vertex.attributes(af_time)$egos)

# erzeugt ein Egonetzwerk
ego_g <- make_ego_graph(af_time, order = 1, nodes = V(af_time)$name == "Anne Frank", mode ="all")
ego_net <- ego_g[[1]]

#Zuweisungen für das Two-Mode Netzwerk
V(ego_net)[V(ego_net)$type == 1]$shape <- "circle"
V(ego_net)[V(ego_net)$type == 2]$shape <- "square"

size <- E(ego_net)$width <- E(ego_net)$weight
E(ego_net)[E(ego_net)$weight == 1]$weight <- "0.5"
E(ego_net)[E(ego_net)$weight == 2]$weight <- "1"
E(ego_net)[E(ego_net)$weight == 3]$weight <- "1.5"
E(ego_net)[E(ego_net)$weight == 4]$weight <- "2"
E(ego_net)[E(ego_net)$weight == 5]$weight <- "2.5"

plot(ego_net,
     
     edge.width=E(ego_net)$weight,
     vertex.size=degree(ego_net), # falls die Knotengröße nach Degree-Wert angezeigt werden soll
     main="Ego-Netzwerk von Anne Frank",
     rescale = TRUE,
     asp = 0,
     layout = layout_nicely,
     #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
     edge.curved = .10,
     vertex.size = 3.5,
     vertex.color = "darkred",
     vertex.frame.color = NA,
     #Gibt die Rahmenfarbe an
     vertex.label.dist = 1.3,
     #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
     vertex.label.family = "Helvetica",
     #Gibt die Schriftart an
     vertex.label.color = "black",
     #Gibt die Schriftfarbe an
     vertex.label.font = 1,
     #Gibt die Schriftgröße an
     vertex.label.degree = pi/2,
     #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
     edge.size = size,
     #edge.lty = 1 #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket,       4=Punktstrich
     edge.color = gray(0.6, alpha=0.9)
     #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
     
     )
```


```{r Teilnetzwerk zu 7 = vor Annes Geburt (1929 und früher) }

list.edge.attributes(af)
edge.attributes(af)$timedefinition

timedefinition7 <- subgraph.edges(af, E(af)[timedefinition==" 7"],)
timedefinition7


E(timedefinition7)$weight

size <- E(ego_net)$width <- E(ego_net)$weight
E(timedefinition7)[E(timedefinition7)$weight == 1]$weight <- "0.5"
E(timedefinition7)[E(timedefinition7)$weight == 2]$weight <- "1"
E(timedefinition7)[E(timedefinition7)$weight == 3]$weight <- "1.5"
E(timedefinition7)[E(timedefinition7)$weight == 4]$weight <- "2"
E(timedefinition7)[E(timedefinition7)$weight == 5]$weight <- "2.5"



plot(timedefinition7, 
        main= "Vor Annes Geburt \n 1929 und früher",
        layout = layout_with_kk,
        edge.width=E(timedefinition7)$weight,
        vertex.color="darkred",
        vertex.label.dist = 1.3,
        #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
        vertex.label.degree = pi/2,
        #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
        edge.lty = 1, #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt,     3=gepunket, 4=Punktstrich)
        vertex.label.family = "Helvetica",
        #Gibt die Schriftart an
        vertex.label.color = "black",
        #Gibt die Schriftfarbe an 
        vertex.label.font = 1,
        #Gibt die Schriftgröße an
        edge.color = gray(0.6, alpha=0.9)
        #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
        )

```

```{r fig.height=12, fig.width=16, Teilnetzwerk zu time definition 1=Frankfurt}

library(igraph)
list.edge.attributes(af)
edge.attributes(af)$timedefinition

timedefinition1 <- subgraph.edges(af, E(af)[timedefinition==" 1"])
timedefinition1

zoom <- layout_nicely(timedefinition1)
zoom <- norm_coords(zoom, ymin=-1, ymax=1 , xmin=-1, xmax=1)
par(mar=c(0,2,0,0))

E(timedefinition1)$weight

size <- E(timedefinition1)$width <- E(timedefinition1)$weight
E(timedefinition1)[E(timedefinition1)$weight == 1]$weight <- "0.5"
E(timedefinition1)[E(timedefinition1)$weight == 2]$weight <- "1"
E(timedefinition1)[E(timedefinition1)$weight == 3]$weight <- "1.5"
E(timedefinition1)[E(timedefinition1)$weight == 4]$weight <- "2"
E(timedefinition1)[E(timedefinition1)$weight == 5]$weight <- "2.5"

plot(timedefinition1, layout = zoom, vertex.size=4, asp = 0, edge.size = size)
plot(
  timedefinition1, 
  asp = 0,
  #Gibt an, in welchem Seitenverhältnis das Netzwerk geplottet werden soll
  rescale = TRUE,
  #Gibt an ob der Plot neu skaliert werden soll
  layout = layout_nicely,
  #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
  #edge.curved=curve_multiple(af_time),
  edge.curved = .15,
  #Gibt die Krümmung der Kanten an
  vertex.size = 5,
  #Gibt die Knotengröße an
  vertex.color = "darkred",
  #Gibt die Knotenfarbe an
  vertex.frame.color = NA,
  #Gibt die Rahmenfarbe an
  main= "Ab Annes Geburt \n Frankfurt bis Umzug nach Amsterdam \n Juni 1929 - Februar 1934",
  #Gibt die Überschrift an
  sub = "Entzerrte Darstellung",
  #Gibt die Unterüberschrift an
  vertex.label.dist = 1.3,
  #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
  vertex.label.family = "Helvetica",
  #Gibt die Schriftart an
  vertex.label.color = "black",
  #Gibt die Schriftfarbe an
  vertex.label.font = 1,
  #Gibt die Schriftgröße an
  vertex.label.degree = pi/2,
  #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
  edge.size = size,
  #edge.lty = 1 #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket, 4=Punktstrich
  edge.color = gray(0.7, alpha=0.7) #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
  )

  #layout=l*2.0)
  #rescale=F
```


```{r fig.height=10, fig.width=18,Teilnetzwerk zu time definition 2 = Amsterdam - Umzug ins Hinterhaus ( Februar 1934 - Juni 1942),fig.height=15, fig.width=15}

list.edge.attributes(af)
edge.attributes(af)$timedefinition

timedefinition2 <- subgraph.edges(af, E(af)[timedefinition==" 2"])
timedefinition2

#Zuweisungen für das Two-Mode Netzwerk
V(timedefinition2)[V(timedefinition2)$type == 1]$shape <- "circle"
V(timedefinition2)[V(timedefinition2)$type == 2]$shape <- "square"

size <- E(timedefinition2)$width <- E(timedefinition2)$weight
E(timedefinition2)[E(timedefinition2)$weight == 1]$weight <- "0.5"
E(timedefinition2)[E(timedefinition2)$weight == 2]$weight <- "1"
E(timedefinition2)[E(timedefinition2)$weight == 3]$weight <- "1.5"
E(timedefinition2)[E(timedefinition2)$weight == 4]$weight <- "2"
E(timedefinition2)[E(timedefinition2)$weight == 5]$weight <- "2.5"


plot(
  timedefinition2,
  asp = 0,
  #Gibt an, in welchem Seitenverhältnis das Netzwerk geplottet werden soll
  rescale = TRUE,
  #Gibt an ob der Plot neu skaliert werden soll
  layout = layout_nicely,
  #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
  #edge.curved=curve_multiple(af_time),
  edge.curved = .15,
  #Gibt die Krümmung der Kanten an
  vertex.size = 5,
  #Gibt die Knotengröße an
  vertex.color = "darkred",
  #Gibt die Knotenfarbe an
  vertex.frame.color = NA,
  #Gibt die Rahmenfarbe an
  main= "Leben in Merwedeplein 37 \n Amsterdam bis zum Untertauchen \n Februar 1934 - Juni 1942",
  #Gibt die Überschrift an
  vertex.label.dist = 1.3,
  #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
  vertex.label.degree = pi/2,
  #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
  edge.lty = 1,
  #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket, 4=Punktstrich
  edge.width=E(timedefinition2)$weight,
  vertex.label.family = "Helvetica",
  #Gibt die Schriftart an
  vertex.label.color = "black",
  #Gibt die Schriftfarbe an
  vertex.label.font = 1,
  #Gibt die Schriftgröße an
  edge.size = size,
  #edge.lty = 1 #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket, 4=Punktstrich
  edge.color = gray(0.6, alpha=0.7) #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
)

```

```{r Helfer und Hinterhausbewohner Gesamtnetzwerk}
list.edge.attributes(af_time)
edge.attributes(af_time)$relationship

relationship1 <- subgraph.edges(af_time,
                                E(af_time)[relationship==" 4"])
relationship1

#Type 2 (Tagebuch) ausblenden
af_time <- delete_vertices(af_time, V(af_time)[type=="2"]) 
af_time


plot(
        relationship1, 
        main="Helfer und Hinterhausbewohner",
        layout= layout_nicely,
        asp = 0,
        rescale = TRUE,
        edge.curved = .15,
        vertex.size = 5,
        vertex.label.dist = 1.3,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        vertex.label.degree = pi/2,
        edge.width=E(relationship1)$weight,
        edge.size = size,
        edge.color = gray(0.7, alpha=0.7))
```


```{r Node-Attribut Resident 2}

#Netzwerk der Hinterhausbewohner (alle außer die Bewohner ausblenden)

resident2 <- delete_vertices(af_time, V(af_time)[resident=="2"]) 
resident2

#Type 2 (Tagebuch) ausblenden
af_time <- delete_vertices(af_time, V(af_time)[type=="2"]) 
af_time



plot(
        resident2, 
        main="Hinterhausbewohner",
        layout= layout_nicely,
        asp = 0,
        rescale = TRUE,
        edge.curved = .15,
        vertex.size = 5,
        vertex.label.dist = 1.3,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        vertex.label.degree = pi/2,
        edge.width=E(resident2)$weight,
        edge.size = size,
        edge.color = gray(0.7, alpha=0.7))

```



```{r fig.height=10, fig.width=18,Teilnetzwerk zu time definition 3 Hinterhaus Teil 1 ( Juli 1942 - Dezember 1942)}

list.edge.attributes(af)
edge.attributes(af)$timedefinition

timedefinition3 <- subgraph.edges(af, E(af)[timedefinition==" 3"])
timedefinition3


#Zuweisungen für das Two-Mode Netzwerk
V(af)[V(af)$type == 1]$shape <- "circle"
V(af)[V(af)$type == 2]$shape <- "square"

size <- E(timedefinition3)$width <- E(timedefinition3)$weight
E(timedefinition3)[E(timedefinition3)$weight == 1]$weight <- "0.5"
E(timedefinition3)[E(timedefinition3)$weight == 2]$weight <- "1"
E(timedefinition3)[E(timedefinition3)$weight == 3]$weight <- "1.5"
E(timedefinition3)[E(timedefinition3)$weight == 4]$weight <- "2"
E(timedefinition3)[E(timedefinition3)$weight == 5]$weight <- "2.5"


plot(
        timedefinition3, 
        main= "Hinterhaus Teil 1 \n Juli 1942 - Dezember 1942",
        edge.width=E(timedefinition3)$weight,
        vertex.color="darkred",
        layout = layout_nicely,
        asp = 0,
        rescale = TRUE,
        edge.curved = .15,
        vertex.size = 5,
        vertex.label.dist = 1.3,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        vertex.label.degree = pi/2,
        edge.size = size,
        edge.color = gray(0.7, alpha=0.7)
        )
```

```{r fig.height=10, fig.width=17,Teilnetzwerk zu time definition 4 Hinterhaus Teil 2 (Januar 1943 - Dezember 1943) }
list.edge.attributes(af)
edge.attributes(af)$timedefinition

timedefinition4 <- subgraph.edges(af, E(af)[timedefinition==" 4"])
timedefinition4

#Zuweisungen für das Two-Mode Netzwerk
V(timedefinition4)[V(timedefinition4)$type == 1]$shape <- "circle"
V(timedefinition4)[V(timedefinition4)$type == 2]$shape <- "square"

size <- E(timedefinition4)$width <- E(timedefinition4)$weight
E(timedefinition4)[E(timedefinition4)$weight == 1]$weight <- "0.5"
E(timedefinition4)[E(timedefinition4)$weight == 2]$weight <- "1"
E(timedefinition4)[E(timedefinition4)$weight == 3]$weight <- "1.5"
E(timedefinition4)[E(timedefinition4)$weight == 4]$weight <- "2"
E(timedefinition4)[E(timedefinition4)$weight == 5]$weight <- "2.5"


plot(
        timedefinition4, 
        asp = 0,
        rescale = TRUE,
        main= "Hinterhaus Teil 2 \n Januar 1943 - Dezember 1943",
        edge.width=E(timedefinition4)$weight,
        vertex.color="darkred",
        edge.curved = .15,
        vertex.size = 5,#Gibt die Knotengröße an
        vertex.frame.color = NA,
        layout = layout_nicely,
        vertex.label.dist = 1.0,
        #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
        vertex.label.degree = pi/2,
        #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
        edge.lty = 1,
        #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket,       4=Punktstrich
        edge.width=E(timedefinition2)$weight,
        vertex.label.family = "Helvetica",
        #Gibt die Schriftart an
        vertex.label.color = "black",
        #Gibt die Schriftfarbe an
        vertex.label.font = 1,
        #Gibt die Schriftgröße an
        edge.size = size,
        #edge.lty = 1 #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt,   3=gepunket, 4=Punktstrich
        edge.color = gray(0.6, alpha=0.7) #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
        )

```

```{r fig.height=10, fig.width=17, Teilnetzwerk zu time definition 5 (Januar 1944 - August 1944)}

list.edge.attributes(af)
edge.attributes(af)$timedefinition

timedefinition5 <- subgraph.edges(af, E(af)[timedefinition==" 5"])
timedefinition5

size <- E(timedefinition5)$width <- E(timedefinition5)$weight
E(timedefinition5)[E(timedefinition5)$weight == 1]$weight <- "0.5"
E(timedefinition5)[E(timedefinition5)$weight == 2]$weight <- "1"
E(timedefinition5)[E(timedefinition5)$weight == 3]$weight <- "1.5"
E(timedefinition5)[E(timedefinition5)$weight == 4]$weight <- "2"
E(timedefinition5)[E(timedefinition5)$weight == 5]$weight <- "2.5"


#Zuweisungen für das Two-Mode Netzwerk
V(timedefinition5)[V(timedefinition5)$type == 1]$shape <- "circle"
V(timedefinition5)[V(timedefinition5)$type == 2]$shape <- "square"

plot(
        timedefinition5, 
        main= "Das letzte Jahr im Hinterhaus \n Januar 1944 - August 1944",
        edge.width=E(timedefinition5)$weight,
        vertex.color="darkred",
        layout= layout_nicely,
        asp = 0,
        rescale = TRUE,
        edge.curved = .15,
        vertex.size = 5,
        vertex.label.dist = 1.3,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        vertex.label.degree = pi/2,
        edge.size = size,
        edge.color = gray(0.7, alpha=0.7))

```

```{r fig.height=250, fig.width=250,Verschiedene Jahre im Vergleich}

# definiert, dass 3 Abbildungen in einer Zeile stehen
par(mfrow=c(6,1), mar=c(0,0,2,1)) 


timedefinition7 <-subgraph.edges(af, E(af)[timedefinition==" 7"])
timedefinition1 <- subgraph.edges(af, E(af)[timedefinition==" 1"]) 
timedefinition2 <- subgraph.edges(af, E(af)[timedefinition==" 2"])
timedefinition3 <- subgraph.edges(af, E(af)[timedefinition==" 3"])
timedefinition4 <- subgraph.edges(af, E(af)[timedefinition==" 4"]) 
timedefinition5 <- subgraph.edges(af, E(af)[timedefinition==" 5"])


plot(timedefinition7, 
        main= "Vor Annes Geburt \n 1929 und früher",
        layout = layout_with_kk,
        edge.width=E(timedefinition7)$weight,
        vertex.color="darkred",
        vertex.label.dist = 1.3,
        vertex.label.degree = pi/2,
        edge.lty = 1,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        edge.color = gray(0.6, alpha=0.9))

plot(
  timedefinition1, 
  asp = 0,
  rescale = TRUE,
  layout = layout_nicely,
  edge.curved = .15,
  vertex.size = 5,
  vertex.color = "darkred",
  vertex.frame.color = NA,
  main= "Ab Annes Geburt \n Frankfurt bis Umzug nach Amsterdam \n Juni 1929 - Februar 1934",
  sub = "Entzerrte Darstellung",
  vertex.label.dist = 1.3,
  vertex.label.family = "Helvetica",
  vertex.label.color = "black",
  vertex.label.font = 1,
  vertex.label.degree = pi/2,
  edge.size = size,
  edge.color = gray(0.7, alpha=0.7)
  )

plot(
  timedefinition2,
  asp = 0,
  rescale = TRUE,
  layout = layout_nicely,
  edge.curved = .15,
  vertex.size = 5,
  vertex.color = "darkred",
  vertex.frame.color = NA,
  main= "Leben in Merwedeplein 37 \n Amsterdam bis zum Untertauchen \n Februar 1934 - Juni 1942",
  vertex.label.dist = 1.3,
  vertex.label.degree = pi/2,
  edge.lty = 1,
  edge.width=E(timedefinition2)$weight,
  vertex.label.family = "Helvetica",
  vertex.label.color = "black",
  vertex.label.font = 1,
  edge.size = size,
  edge.color = gray(0.6, alpha=0.7) #alpha ist Transparenz gray gibt an von 0 (weiß) bis 1 (schwarz)
)


plot(
        timedefinition3, 
        main= "Hinterhaus Teil 1 \n Juli 1942 - Dezember 1942",
        edge.width=E(timedefinition3)$weight,
        vertex.color="darkred",
        layout = layout_nicely,
        asp = 0,
        rescale = TRUE,
        edge.curved = .15,
        vertex.size = 5,
        vertex.label.dist = 1.3,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        vertex.label.degree = pi/2,
        edge.size = size,
        edge.color = gray(0.7, alpha=0.7)
        )

plot(
        timedefinition4, 
        asp = 0,
        rescale = TRUE,
        main= "Hinterhaus Teil 2 \n Januar 1943 - Dezember 1943",
        edge.width=E(timedefinition4)$weight,
        vertex.color="darkred",
        edge.curved = .15,
        vertex.size = 5,
        vertex.frame.color = NA,
        layout = layout_nicely,
        vertex.label.dist = 1.0,
        vertex.label.degree = pi/2,
        edge.lty = 1,
        edge.width=E(timedefinition2)$weight,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        edge.size = size,
        edge.color = gray(0.6, alpha=0.7)
        )

plot(
        timedefinition5, 
        main= "Das letzte Jahr im Hinterhaus \n Januar 1944 - August 1944",
        edge.width=E(timedefinition5)$weight,
        vertex.color="darkred",
        layout= layout_nicely,
        asp = 0,
        rescale = TRUE,
        edge.curved = .15,
        vertex.size = 5,
        vertex.label.dist = 1.3,
        vertex.label.family = "Helvetica",
        vertex.label.color = "black",
        vertex.label.font = 1,
        vertex.label.degree = pi/2,
        edge.size = size,
        edge.color = gray(0.7, alpha=0.7))
     
```

```{r Verräternetzwerk}

#Netzwerk der potenziellen Verräter der Hinterhausbewohner

```


```{r Auswahl Vertex-Attribute}

list.vertex.attributes(af)
vertex.attributes(af)$name
vertex.attributes(af)$sex
vertex.attributes(af)$religion
vertex.attributes(af)$survival
vertex.attributes(af)$type.of.death
vertex.attributes(af)$place.of.death
vertex.attributes(af)$type
```


```{r fig.height=10, fig.width=10, Teilnetzwerk zum Konfliktpotenzial time definition 2=}

#Daten aus der Edgelist laden
edges <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/edgelist.csv", header=T, as.is=T)

#Daten aus der Nodelist laden
nodes <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/nodelist.csv", header=T, as.is=T)

#Matrix erstellen aus Fusion der Edge- und Nodelist
edgematrix <-as.matrix(edges)
af <- graph_from_data_frame(d=edgematrix, vertices=nodes, directed=FALSE)
af


#Soll anhand der Kantenfarben zeigen, dass Konflikte mit dem Umzug in das Hinterhaus zunehmen

from_data_frame(d=edgematrix, vertices=nodes, directed=FALSE)
af

list.edge.attributes(af)
edge.attributes(af)$timedefinition

konflikt2 <- subgraph.edges(af, E(af)[timedefinition==" 2"]) 
konflikt2

# Überprüfen der Edge-Attribute
edge.attributes(konflikt2)$weight
edge.attributes(konflikt2)$relationship
edge.attributes(konflikt2)$konfliktpotenzial

#Zuweisungen für das Two-Mode Netzwerk
V(konflikt2)[V(konflikt2)$type == 1]$shape <- "circle"
V(konflikt2)[V(konflikt2)$type == 2]$shape <- "square"

#Löscht alle Verbindungen, die mit 99 codiert sind (keine Angabe)


E(konflikt2)[E(konflikt2)$konfliktpotenzial == " 1"]$color <- "yellow"
E(konflikt2)[E(konflikt2)$konfliktpotenzial == " 2"]$color <- "orange"
E(konflikt2)[E(konflikt2)$konfliktpotenzial == " 3"]$color <- "red"
E(konflikt2)[E(konflikt2)$konfliktpotenzial == " 4"]$color <- "dark red"
E(konflikt2)[E(konflikt2)$konfliktpotenzial == "99"]$color <- "NA" 

plot(konflikt2,
     layout=layout_nicely,
      asp = 0,
     edge.width= 3,
       rescale = TRUE,
      edge.curved = .15,
     vertex.size = 5.0,
       vertex.color = "grey",
    #Gibt die Knotengröße an
    vertex.color = "darkred",
    #Gibt die Knotenfarbe an
    vertex.frame.color = NA,
    vertex.label.dist=0.6,
    vertex.label.dist = 1.3,
  vertex.label.degree = pi/2,
  edge.lty = 1,
  vertex.label.font = 1,
          vertex.label.family = "Helvetica",
        vertex.label.color = "black",
  edge.size = size,
     main="Konflikpotenzial \n Leben in Merwedeplein 37 Amsterdam bis zum Untertauchen \n Februar 1934 - Juni 1942")

```
```{r Teilnetz werk zum Konfkliktpotenzial time definiton 3}
list.edge.attributes(af)
edge.attributes(af)$timedefinition

konflikt3 <- subgraph.edges(af, E(af)[timedefinition==" 3"]) 
konflikt3

E(konflikt3)[E(konflikt3)$konfliktpotenzial == " 1"]$color <- "yellow"
E(konflikt3)[E(konflikt3)$konfliktpotenzial == " 2"]$color <- "orange"
E(konflikt3)[E(konflikt3)$konfliktpotenzial == " 3"]$color <- "red"
E(konflikt3)[E(konflikt3)$konfliktpotenzial == " 4"]$color <- "dark red"


#Zuweisungen für das Two-Mode Netzwerk
V(konflikt3)[V(konflikt3)$type == 1]$shape <- "circle"
V(konflikt3)[V(konflikt3)$type == 2]$shape <- "square"

plot(konflikt3,
     edge.arrow.size=.3,
     layout=layout_nicely,
     edge.curved=.2,
     edge.curved=curve_multiple(konflikt3),
     vertex.size = 5.0,
    #Gibt die Knotengröße an
    vertex.color = "darkred",
    #Gibt die Knotenfarbe an
    vertex.frame.color = NA,
    vertex.label.dist=0.6,
     main="Konflikpotenzial Juli 1942 - Dezember 1942")
```



```{r Teilnettwerk zum Konfliktpotenzial time definition 4 Hinterhaus Teil 2 (1943 Janaur - Dezember)}

list.edge.attributes(af)
edge.attributes(af)$timedefinition


konflikt4 <- subgraph.edges(af, E(af)[timedefinition==" 4"]) 
konflikt4

E(konflikt4)[E(konflikt4)$konfliktpotenzial == " 1"]$color <- "yellow"
E(konflikt4)[E(konflikt4)$konfliktpotenzial == " 2"]$color <- "orange"
E(konflikt4)[E(konflikt4)$konfliktpotenzial == " 3"]$color <- "red"
E(konflikt4)[E(konflikt4)$konfliktpotenzial == " 4"]$color <- "dark red"


#Zuweisungen für das Two-Mode Netzwerk
V(konflikt4)[V(konflikt4)$type == 1]$shape <- "circle"
V(konflikt4)[V(konflikt4)$type == 2]$shape <- "square"

plot(konflikt4,
     edge.arrow.size=.3,
     layout=layout_nicely,
     edge.curved=.2,
     edge.curved=curve_multiple(konflikt4),
     vertex.size = 5.0,
    #Gibt die Knotengröße an
    vertex.color = "darkred",
    #Gibt die Knotenfarbe an
    vertex.frame.color = NA,
    vertex.label.dist=0.6,
     main="Konflikpotenzial Januar 1934 - Dezember 1943")
```

```{r Teilnetzwerk zum Konfliktpotenzial time definition 5 (Janaur 1944 - August 1944)}

list.edge.attributes(af)
edge.attributes(af)$timedefinition

konflikt5 <- subgraph.edges(af, E(af)[timedefinition==" 5"]) 
konflikt5

E(konflikt5)[E(konflikt5)$konfliktpotenzial == " 1"]$color <- "yellow"
E(konflikt5)[E(konflikt5)$konfliktpotenzial == " 2"]$color <- "orange"
E(konflikt5)[E(konflikt5)$konfliktpotenzial == " 3"]$color <- "red"
E(konflikt5)[E(konflikt5)$konfliktpotenzial == " 4"]$color <- "dark red"


#Zuweisungen für das Two-Mode Netzwerk
V(konflikt5)[V(konflikt5)$type == 1]$shape <- "circle"
V(konflikt5)[V(konflikt5)$type == 2]$shape <- "square"

plot(konflikt5,
     edge.arrow.size=.3,
     layout=layout_nicely,
     edge.curved=.2,
     edge.curved=curve_multiple(konflikt5),
     vertex.size = 5.0,
    #Gibt die Knotengröße an
    vertex.color = "darkred",
    #Gibt die Knotenfarbe an
    vertex.frame.color = NA,
    vertex.label.dist=0.6,
     main="Konflikpotenzial Januar 1944 - August 1944")
```


```{r Clusternetzwerk}
#Komponenten analysieren

# Grafik des Gesamtnetzwerks
plot(af_time, layout=layout_with_kk, main="Gesamtnetzwerk")

# Anzahl der Komponenten
count_components(af_time)

# Um genauer zu verstehen, welche Vertices zu welcher Gruppe gehören, lassen sie sich mit dem Befehl groups(g) in Grupppen unterteilten. 
af_groups <- groups(components(af_time))
af_groups

```
```{r Komponenten zerglegen, fig.height=9, fig.width=16}
library(igraph)
# Anzahl der Komponenten

af_cluster <- cluster_walktrap(af_time)
af_cluster
plot(af_cluster, af_time)

# Berechnet Gruppen anhand von den küzesten Pfaden
```

```{r Cluster analysieren}
# Anzahl der Clusters
clusters(af_time)

# Sind die Cluster miteinander verbunden?
is_connected(af_time)

```


```{r Clusterberechnung nach Betweenness}

# Clusterberechnung
plot(af_time, vertex.color="grey80", main="Komponente 1")

#Isolates rauswerfen
af_time_isolate <- delete.vertices(af_time, degree(af_time) == 0)

# Berechnung der Cluster innerhalb der Komponente
?cluster_edge_betweenness()

# erstellt die Berechnung für die Modularität und deren Teilgruppen
eb <- cluster_edge_betweenness(af_time_isolate)
eb

plot(eb, af_time_isolate, 
     main="Edge-Betweenness Cluster")

```


```{r Netzwerk nach Religionen, fig.height=9, fig.width=9}

# 1 = Jude, 2=Christ, 3=Sonstiges

vertex.attributes(af)$religion
V(af_time)[V(af_time)$religion=="1"]$color <- "yellow"
V(af_time)[V(af_time)$religion=="2"]$color <- "blue"
V(af_time)[V(af_time)$religion=="3"]$color <- "beige"

#Zuweisungen für das Two-Mode Netzwerk
V(af_time)[V(af_time)$type == 1]$shape <- "circle"
V(af_time)[V(af_time)$type == 2]$shape <- "square"


#Type 2 (Tagebuch) ausblenden
af_time <- delete_vertices(af_time, V(af_time)[type=="2"]) 
af_time

#Blendet alles Knoten aus, zu denen es keine Angabe bezüglich der Religion gibt
af_time <- delete_vertices(af_time, V(af_time)[religion=="99"]) 
af_time

# blendet den Rahmen um den Vertex aus.
V(af_time)$frame.color <- "NA"

plot(af_time,
     layout=layout_with_kk,
     edge.curved=curve_multiple(af),
     #edge.curved=.15,
     main="Gesamtnetzwerk der Religionen",
     sub="Gelb= Jude, Blau=Christ, Beige=Sonstiges",
     asp = 0,
  #Gibt an, in welchem Seitenverhältnis das Netzwerk geplottet werden soll
  rescale = TRUE,
  #Gibt an ob der Plot neu skaliert werden soll
  layout = layout_nicely,
  #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
  #edge.curved=curve_multiple(af_time),
  edge.curved = .15,
  #Gibt die Krümmung der Kanten an
  edge.arrow.size = .3,
  #Gibt die Pfeilgröße der Kanten an
  vertex.size = 3.5,
  #Gibt die Knotengröße an
  vertex.frame.color = NA,
  #Gibt die Rahmenfarbe an
  vertex.label.dist = 0.6,
  #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
  #vertex.label.degree = pi/2,
  #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
  edge.lty = 1 #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket, 4=Punktstrich
  )

```


```{r fig.height=9, fig.width=9, Gesamtnetzwerk - Visualisierung der Überlebenden im zeitlichen Verlauf}

# setzt den Wert grau=gestorben während 2. Weltkrieg(4), gelb=überlebt(5), grau=gestorben vor dem 2. Weltkrieg (3),grau=gestorben während 1.Weltkrieg (2),grau=gestorben vor dem 1. Weltkrieg(1),

#Alle schwarz anzeigen, die vor dem 1.Weltkrieg gestorben sind
vertex.attributes(af)$survival
V(af_time)[V(af_time)$survival=="1"]$color <- "black"
V(af_time)[V(af_time)$survival=="2"]$color <- "black"
V(af_time)[V(af_time)$survival=="3"]$color <- "beige"
V(af_time)[V(af_time)$survival=="4"]$color <- "beige"
V(af_time)[V(af_time)$survival=="5"]$color <- "beige"

#Blendet alles Knoten aus, zu denen es keine Angabe bezüglich des Todes gibt
af_time <- delete_vertices(af_time, V(af_time)[survival=="99"]) 
af_time

#Zuweisungen für das Two-Mode Netzwerk
V(af_time)[V(af_time)$type == 1]$shape <- "circle"
V(af_time)[V(af_time)$type == 2]$shape <- "square"

plot(af_time,
     layout=layout_with_kk,
     main="Gestorben vor und während dem 1.Weltkrieg",
     asp = 0,
  #Gibt an, in welchem Seitenverhältnis das Netzwerk geplottet werden soll
  rescale = TRUE,
  #Gibt an ob der Plot neu skaliert werden soll
  layout = layout_nicely,
  #Gibt an, mit welchem Algorithmus das Netzwerk berechnet werden soll
  #edge.curved=curve_multiple(af_time),
  edge.curved = .15,
  #Gibt die Krümmung der Kanten an
  edge.arrow.size = .3,
  #Gibt die Pfeilgröße der Kanten an
  vertex.size = 3.5,
  #Gibt die Knotengröße an
  vertex.frame.color = NA,
  #Gibt die Rahmenfarbe an
  vertex.label.dist = 0.6,
  #Gibt die Distanz zwischen dem Knotenmittelpunkt und dem label an
  #vertex.label.degree = pi/2,
  #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
  edge.lty = 1,
  #Gibt an, welche Darstellungsform eine Kante haben soll. 0=Leer, 1=normal, 2=gestrichelt, 3=gepunket, 4=Punktstrich
  vertex.label.family = "Helvetica",
  vertex.label.color = "black",
  #Gibt die Schriftfarbe an
  vertex.label.font = 1,
  #Gibt die Schriftgröße an
  vertex.label.degree = pi/2,
  #Gibt an, wo die Schrift stehen soll (pi ist link | pi/2 unten | -pi/2 oben | -pi/4 rechts)
  edge.color = gray(0.6, alpha=0.9)
  
)


```



```{r}

#Vor/während dem 1.Weltkrieg gestorben, Gestorben vor dem 2.Weltkrieg 
vertex.attributes(af)$survival
V(af)[V(af)$survival=="1"]$color <- "black"
V(af)[V(af)$survival=="2"]$color <- "black"
V(af)[V(af)$survival=="3"]$color <- "black"
V(af)[V(af)$survival=="4"]$color <- "beige"
V(af)[V(af)$survival=="5"]$color <- "beige"


#Zuweisungen für das Two-Mode Netzwerk
V(af)[V(af)$type == 1]$shape <- "circle"
V(af)[V(af)$type == 2]$shape <- "square"

plot(af,
     layout=layout_with_kk,
     edge.curved=curve_multiple(af),
     main="Gestorben vor/während dem 1.Weltkrieg, \n Gestorben vor dem 2.Weltkrieg")
```

```{r}
#Vor/während dem 1.Weltkrieg gestorben, Gestorben vor dem 2.Weltkrieg, Gestorben während 2.Weltkrieg

vertex.attributes(af)$survival
V(af)[V(af)$survival=="1"]$color <- "black"
V(af)[V(af)$survival=="2"]$color <- "black"
V(af)[V(af)$survival=="3"]$color <- "black"
V(af)[V(af)$survival=="4"]$color <- "black"
V(af)[V(af)$survival=="5"]$color <- "beige"


#Zuweisungen für das Two-Mode Netzwerk
V(af)[V(af)$type == 1]$shape <- "circle"
V(af)[V(af)$type == 2]$shape <- "square"

plot(af,
     layout=layout_with_kk,
     edge.curved=curve_multiple(af),
     main="Gestorben vor/während dem 1.Weltkrieg, \n Gestorben vor dem 2.Weltkrieg, \n Gestorben während 2.Weltkrieg")
```

```{r Todesarten der Verstorbenen}

#1=Vergasung, 2=Fahrlässige Tötung im KZ, 3 = Natürlicher Tod, 4 = überlebt

vertex.attributes(af)$type.of.death

V(af)[V(af)$type.of.death=="1"]$color <- "grey"
V(af)[V(af)$type.of.death=="2"]$color <- "red"
V(af)[V(af)$type.of.death=="3"]$color <- "orange"
V(af)[V(af)$type.of.death=="4"]$color <- "green"

#Type 2 (Tagebuch) ausblenden
af <- delete_vertices(af, V(af)[type=="2"]) 
af

plot(af,
     layout=layout_with_kk,
     edge.curved=curve_multiple(af),
     main="Todesarten der Verstorbenen",
     sub="orange = natürlicher Tod, grün=überlebt, \n rot=fahrlässige Tötung im KZ, grau=Vergasung")

```


```{r Todesarten innerhalb der Religionen (Juden)}

#1=Vergasung, 2=Fahrlässige Tötung im KZ, 3 = Natürlicher Tod, 4 = überlebt
#Todesarten innerhalb der religion=Jude (2)

list.vertex.attributes(af)
vertex_attr(af)$religion

typeofdeath_jude <- delete_vertices(af, V(af)[religion=="2"]) 
typeofdeath_jude

V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="1"]$color <- "grey"
V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="2"]$color <- "red"
V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="3"]$color <- "orange"
V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="4"]$color <- "green"

#Type 2 (Tagebuch) ausblenden
af <- delete_vertices(af, V(af)[type=="2"]) 
af

plot(typeofdeath_jude,
     layout=layout_with_kk,
     edge.curved=curve_multiple(af),
     main="Todesarten der verstorbenen Juden",
     sub="orange = natürlicher Tod, grün=überlebt, \n rot=fahrlässige Tötung im KZ, grau=Vergasung")
```


```{r Todesarten innerhalb der Religionen (Christen)}
#1=Vergasung, 2=Fahrlässige Tötung im KZ, 3 = Natürlicher Tod, 4 = überlebt
#Todesarten innerhalb der religion=Jude (2)

list.vertex.attributes(af)
vertex_attr(af)$religion

typeofdeath_jude <- delete_vertices(af, V(af)[religion=="1"]) 
typeofdeath_jude

V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="1"]$color <- "grey"
V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="2"]$color <- "red"
V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="3"]$color <- "orange"
V(typeofdeath_jude)[V(typeofdeath_jude)$type.of.death=="4"]$color <- "green"

#Type 2 (Tagebuch) ausblenden
af <- delete_vertices(af, V(af)[type=="2"]) 
af

plot(typeofdeath_jude,
     layout=layout_with_kk,
     edge.curved=curve_multiple(af),
     main="Todesarten der verstorbenen Christen",
     sub="orange = natürlicher Tod, grün=überlebt, \n rot=fahrlässige Tötung im KZ, grau=Vergasung")

```



```{r Netzwerkmaße berechnen - igraph Objekt erstellen }
# Wir lesen unser Netzwerk ein:

#Daten aus der Edgelist laden
edges <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/edgelist.csv", header=T, as.is=T)

#Daten aus der Nodelist laden
nodes <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/nodelist.csv", header=T, as.is=T)

#Matrix erstellen aus Fusion der Edge- und Nodelist
edgematrix <-as.matrix(edges)
af <- graph_from_data_frame(d=edgematrix, vertices=nodes, directed=FALSE)
af

```


Wir haben 83 Knoten und 926 Kanten. Beacgten: Diese Zahl bezieht sich auf alle 4 Jahre! 


# Netzwerkmaße im Überblick

Die wichtigsten Netzwerkmaße sind:
* Dichte (density)
* Durchmesser (diameter)
* Pfaddistanz (path_distance)

*Positionale Maße* geben eine Auskunft über die Bedeutung der einzelnen Knoten innerhalb des Netzwerks. 
Die wichtigste postionalen oder akteursbezogenen Maße sind:
* Degree (indegree/outdegree)
* Closeness
* Betweenness


### Dichte (Density)

```{r Dichte generell}


# Berechnung der Dichte des Netzwerks af
edge_density(af)


```

Die Dichte in unserem Netzwerk beträg t0.2721128 das bedeutet, dass 27,21 % (gerundet), von allen möglichen Beziehungen zwischen den Knoten realisiert wurde. Dies bedeutet auch, dass zwischen knapp 73% der Knoten keine Beziehungen bestehen. Wir gehen zu leicht davon aus, dass Netzwerke eine hohe Dichte haben. Das würde aber voraussetzen, dass jeder Knoten mit allen anderen Knoten verbunden ist, wie dies etwa in Cliquen der Fall ist.

Aussagekräftig werden die Dichtewerte besonders dann, wenn Netzwerke miteinander verglichen werden. Dazu können wir z.B. das Gesamtnetzwerk in die einzelnen Jahre zerlegen und untersuchen. 
```{r}

# Berechnung der Dichte des Netzwerks af_time
edge_density(timedefinition7)


```


```{r}

# Berechnung der Dichte des Netzwerks af_time
edge_density(timedefinition1)


```

```{r}
# Berechnung der Dichte des Netzwerks af_time
edge_density(timedefinition2)

```

```{r}
# Berechnung der Dichte des Netzwerks af_time
edge_density(timedefinition3)
```

```{r}
# Berechnung der Dichte des Netzwerks af_time
edge_density(timedefinition4)
```

```{r}
# Berechnung der Dichte des Netzwerks af_time
edge_density(timedefinition5)
```


```{r Betweenness}
betweenness(af_time, normalized = TRUE)

View(betweenness(af_time, normalized = TRUE))
#Da die Datenausgabe im Chunk limitiert ist, nutzen wir den Befehl View um eine bessere Übersicht zu erhalten.
```


```{r Dichte: Vergleich der Teilnetzwerke}

# Wir lesen unser Netzwerk ein:

#Daten aus der Edgelist laden
edges <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/edgelist.csv", header=T, as.is=T)

#Daten aus der Nodelist laden
nodes <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/nodelist.csv", header=T, as.is=T)

#Matrix erstellen aus Fusion der Edge- und Nodelist
edgematrix <-as.matrix(edges)
af <- graph_from_data_frame(d=edgematrix, vertices=nodes, directed=FALSE)
af


# Teilnetzwerke erstellen
timedefinition7 <- subgraph.edges(af, E(af)[timedefinition==" 7"])
timedefinition7
timedefinition1 <- subgraph.edges(af, E(af)[timedefinition==" 1"])
timedefinition1
timedefinition2 <- subgraph.edges(af, E(af)[timedefinition==" 2"]) 
timedefinition2
timedefinition3 <- subgraph.edges(af, E(af)[timedefinition==" 3"])
timedefinition3
timedefinition4 <- subgraph.edges(af, E(af)[timedefinition==" 4"])
timedefinition4
timedefinition5 <- subgraph.edges(af, E(af)[timedefinition==" 5"])
timedefinition5
timedefinition6 <- subgraph.edges(af, E(af)[timedefinition==" 6"])
timedefinition6

# Visualisierung
par(mfrow=c(1,8), mar=c(0,0,2,1)) 

plot(af, main="Gesamtnetzwerk")
plot(timedefinition7, main="Vor Annes Geburt (1929 und früher)")
plot(timedefinition1, main="Frankfurt (Geburt Juni 1929 bis Februar 1934)")
plot(timedefinition2, main="Amsterdam Umzug ins Hinterhaus (Februar 1934 - Juni1942)")
plot(timedefinition3, main="Hinterhaus Teil 1 (Juli 1942 - Dezember 1942)")
plot(timedefinition4, main="Hinterhaus Teil 2 (Januar 1943 - Dezember 1943)")
plot(timedefinition5, main="Hinterhaus Teil 3 (Januar 1944 - August 1944)")
plot(timedefinition6, main="Nach dem Krieg (Januar 1946)")


par(mfrow=c(1,1), mar=c(0,0,1,1)) 

# Berechnung der Dichte für die Netzwerke
edge_density(af)
edge_density(timedefinition7)
edge_density(timedefinition1)
edge_density(timedefinition2)
edge_density(timedefinition3)
edge_density(timedefinition4)
edge_density(timedefinition5)
edge_density(timedefinition6)

par(mfrow=c(1,3), mar=c(0,0,2,1)) 
```

Die höchste Dichte findet sich bei Timedefinition 3. Die Dichte ist die gesamte Zeit in der sie im Hinterhaus sind sehr hoch ( am höchsten).



## Durchmesser (diameter)
Der Durchmesser ist ein wichtiges Maß, um die Konstellation eines Netzwerks besser zu verstehen. Auch hier richtet sich die Analyse wieder nach einem Vergleich.


```{r Diameter (Durchmesser)}
# https://igraph.org/r/doc/diameter.html


#Matrix erstellen aus Fusion der Edge- und Nodelist
edgematrix <-as.matrix(edges)
af_time <- graph_from_data_frame(d=edgematrix, vertices=nodes, directed=FALSE)
af_time

# Was ist der kürzeste Pfad in einem Netzwerk?
get.diameter(af_time)

# Welche Knoten sind am weitesten voneinander entfernt?
farthest_vertices(af_time)
```
Charlotte Kalette und Bertus Hulsman sind die am weitesten entfernten Knoten mit der Distanz von 12.



```{r Kürzeste Pfaddistanz visualisieren}
# Wir lesen unser Netzwerk ein:

#Daten aus der Edgelist laden
edges <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/edgelist.csv", header=T, as.is=T)

#Daten aus der Nodelist laden
nodes <- read.csv("https://raw.githubusercontent.com/AnneFrank2020/Anne_Frank_Netzwerk/master/Abgabe/nodelist.csv", header=T, as.is=T)

#Matrix erstellen aus Fusion der Edge- und Nodelist
edgematrix <-as.matrix(edges)
af <- graph_from_data_frame(d=edgematrix, vertices=nodes, directed=FALSE)
af


# Visualisierung der Pfaddistanz
# 
dia <- get.diameter(af_time, directed=T) # ruft die Werte auf
vcol <- rep("gray80", vcount(af_time)) # setzt alle Werte der Knoten auf grau
vcol[dia] <- "gold" # setzt alle Vertices des Diameters auf gold
ecol <- rep("gray80", ecount(af_time)) # setzt alle Kanten auf grau
ecol[E(af_time, path=dia)] <- "orange" # definiert die Farbe des Pfads

# sucht die Kanten entlang des Pfades und färbt diese ein
plot(af_time,
     layout=layout_with_kk,
     vertex.color=vcol,
     edge.color=ecol,
     edge.arrow.size=.2,
     edge.curved=.2,
     main="Diameter im Netzwerk",
     sub="Durchmesser auf dem kürzesten Weg")

```



```{r Die größte Cliquen}

clique_num(af_time)

# Größte Cliquen finden
großecli <- largest_cliques(af_time)
af_cli <- subgraph(af_time, großecli[[1]])
plot(af_cli,
     main= "Größte Clique")
```

```{r}
# Berechnung der Dichte des Netzwerks af_time
edge_density(af_cli)
```

